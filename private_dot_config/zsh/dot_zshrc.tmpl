{{- if .integration.zsh.enabled -}}
{{ $bogus := (. | setValueAtPath "custom.shell" "zsh") -}}
{{ template "xdg_env.tmpl" . }}
{{- if lookPath "brew" }}
{{ template "brew_env.tmpl" . }}
{{- end }}

(( $+commands[vim] )) && export EDITOR=vim || export EDITOR=nano

if [ "$VSCODE_INJECTION" = "1" ]; then
    (( $+commands[code-insiders] )) && export EDITOR=code-insiders || export EDITOR=code
fi

zstyle :omz:plugins:ssh-agent agent-forwarding on
zstyle :omz:plugins:ssh-agent lazy yes
zstyle :omz:update mode disabled

{{ if .integration.zsh.omz -}}
{{ template "omz_env.tmpl" . }}
{{ else if .integration.zsh.antidote -}}
{{ template "antidote_env.tmpl" . }}
{{ end -}}

{{ if eq .chezmoi.os "linux" -}}
export GPG_TTY=$(tty)
{{ if not ( contains "code-server" .chezmoi.hostname) -}}
VSCODE=code-insiders

{{ end -}}
{{ end -}}

export PATH="$HOME/.local/bin:$HOME/.local/wrapped:$PATH"
export LC_tmux_session=remote

{{ if .integration.hishtory.enabled -}}
source ${XDG_CONFIG_HOME}/hishtory/config.zsh

{{ end -}}

{{ template "wsl_env.tmpl" . }}

autoload -U +X bashcompinit && bashcompinit
autoload -Uz +X compinit && compinit

(( $+_comps[chezmoi] )) && source <(chezmoi completion zsh)
(( $+commands[docker] )) && source <(docker completion zsh)
(( $+_comps[hishtory] )) && source <(hishtory completion zsh)
(( $+_comps[oh-my-posh] )) && source <(oh-my-posh completion zsh)

(( $+commands[bat] )) && \
    export BAT_THEME="DarkNeon" && \
    export MANPAGER="sh -c 'col -bx | bat -l man -p'" && \
    alias -g -- --help='--help 2>&1 | bat --language=help --style=plain' && \
    alias -g -- -h='-h 2>&1 | bat --language=help --style=plain' && \
    alias cat="bat --paging=never" && \
    alias rcat="command cat"

{{ if .integration.bitwarden.enabled -}}
(( $+_comps[bw] )) && eval "$(bw completion --shell zsh); compdef _bw bw;"
alias bwopen='export BW_SESSION=${BW_SESSION:-$(bw unlock --raw)}'

{{ end -}}

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

if [ "$TERM_PROGRAM" != "Apple_Terminal" ]; then
    eval "$(oh-my-posh init zsh --config ~/.config/oh-my-posh.yaml)"
fi

{{ if .integration.zsh.antidote -}}
antidote load
{{ end -}}
{{ end -}}
