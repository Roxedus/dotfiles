{{- if .integration.zsh.enabled -}}
{{ $bogus := (. | setValueAtPath "custom.shell" "zsh") -}}

{{ template "xdg_env.tmpl" . }}
{{ template "brew_env.tmpl" . }}
{{ template "wsl_env.tmpl" . }}
(( $+commands[vim] )) && export EDITOR=vim || export EDITOR=nano

{{ template "code_env.tmpl" . }}

{{/* ---- */ -}}

zstyle :omz:plugins:ssh-agent agent-forwarding on
zstyle :omz:plugins:ssh-agent lazy yes
zstyle :omz:update mode disabled

{{ if .integration.zsh.omz -}}
{{ template "omz_env.tmpl" . }}
{{ else if .integration.zsh.antidote -}}
{{ template "antidote_env.tmpl" . }}
{{ end -}}

{{ if eq .chezmoi.os "linux" -}}
export GPG_TTY=$(tty)
{{ end -}}

export PATH="$HOME/.local/bin:$HOME/.local/wrapped:$PATH"
export LC_tmux_session=remote

(( $+commands[chezmoi] )) && (( $+_comps[chezmoi] )) && source <(chezmoi completion zsh)
(( $+commands[docker] )) && (( $+_comps[docker] )) && source <(docker completion zsh)
(( $+commands[hishtory] )) && (( $+_comps[hishtory] )) && source <(hishtory completion zsh)
(( $+commands[oh-my-posh] )) && (( $+_comps[oh-my-posh] )) && source <(oh-my-posh completion zsh)

(( $+commands[bat] )) && \
    export BAT_THEME="Nord" && \
    export MANPAGER="sh -c 'col -bx | bat -l man -p'" && \
    alias -g -- --help='--help 2>&1 | bat --language=help --style=plain' && \
    alias -g -- -h='-h 2>&1 | bat --language=help --style=plain' && \
    alias cat="bat --paging=never" && \
    alias rcat="command cat"

{{ if .integration.bitwarden.enabled -}}
(( $+commands[bw] )) && (( $+_comps[bw] )) && source <(bw completion --shell zsh)
alias bwopen='export BW_SESSION=${BW_SESSION:-$(bw unlock --raw)}'

{{ end -}}

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

if [ "$TERM_PROGRAM" != "Apple_Terminal" ]; then
    eval "$(oh-my-posh init zsh --config ~/.config/oh-my-posh.yaml)"
fi

{{ if .integration.zsh.antidote -}}
antidote load
{{ end -}}
{{ if .integration.hishtory.enabled -}}
source ${XDG_CONFIG_HOME}/hishtory/config.zsh
{{ end }}
{{ end -}}
