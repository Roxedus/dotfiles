{{- if .integration.zsh.enabled -}}
{{- if lookPath "brew" -}}
{{ template "brew_env.tmpl" dict "shell" "zsh" "os" .chezmoi.os }}
{{- end }}

export EDITOR=nano

(( $+commands[vim] )) && export EDITOR=vim

export ZSH=$HOME/.oh-my-zsh

HIST_STAMPS="%d/%m/%y %T"
HISTFILE="$ZDOTDIR/.zhistory"
ZSH_CACHE_DIR="${XDG_CACHE_HOME:-$HOME/.cache}/ohmyzsh"

plugins=(
    ansible
    colored-man-pages
    colorize
    command-not-found
    common-aliases
    docker
    docker-compose
    git
    terraform
    history
    kubectl
    pip
    ssh-agent
    virtualenv
    zsh-autosuggestions
    zsh-syntax-highlighting
    {{ if eq .chezmoi.os "darwin" -}}
    iterm2
    {{ end -}}
    {{ if not ( contains "code-server" .chezmoi.hostname) -}}
    gpg-agent
    vscode
    {{ end -}}
    {{ if eq .chezmoi.os "linux" -}}
    {{ if eq .chezmoi.osRelease.name "Ubuntu" -}}
    {{ end -}}
    {{ end -}}
    )

zstyle :omz:plugins:ssh-agent agent-forwarding on
zstyle :omz:plugins:ssh-agent lazy yes
zstyle :omz:update mode disabled

source $ZSH/oh-my-zsh.sh

{{ if eq .chezmoi.os "linux" -}}
export GPG_TTY=$(tty)
{{ if not ( contains "code-server" .chezmoi.hostname) -}}
VSCODE=code-insiders

{{ end -}}
{{ end -}}

{{ if eq .chezmoi.os "darwin" -}}
source ~/.config/iterm2.sh

{{ end -}}

alias zshconfig="${EDITOR} $ZDOTDIR/.zshrc"
alias ohmyzsh="${EDITOR} $ZSH"

export PATH="$PATH:$HOME/.local/bin"

{{ if .integration.hishtory.enabled -}}
{{ template "hishtory_env.tmpl" . -}}
source $HOME/$HISHTORY_PATH/config.zsh

{{ end -}}

{{ template "wsl_env.tmpl" . }}

fpath=($HOME/.zsh/completion $fpath)

#    autoload -U +X bashcompinit && bashcompinit
#    autoload -Uz compinit && compinit
{{ if .machine.controlplane -}}
(( $+_comps[argocd] )) && source <(argocd completion zsh)
(( $+_comps[helm] )) && source <(helm completion zsh)
{{ end -}}
(( $+_comps[chezmoi] )) && source <(chezmoi completion zsh)
(( $+_comps[hishtory] )) && source <(hishtory completion zsh)

(( $+commands[bat] )) && alias cat=bat && alias rcat=/bin/cat

{{ if .integration.bitwarden.enabled -}}
(( $+_comps[bw] )) && eval "$(bw completion --shell zsh); compdef _bw bw;"
alias bwopen='export BW_SESSION=$(bw unlock --raw)'

{{ end -}}

if [ -f ~/.bash_aliases ]; then
    . ~/.bash_aliases
fi

if [ "$TERM_PROGRAM" != "Apple_Terminal" ]; then
    eval "$(oh-my-posh init zsh --config ~/.config/oh-my-posh.yaml)"
fi
{{ end -}}
